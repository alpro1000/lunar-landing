<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>Lunar Dream Calendar ‚Äî –õ—É–Ω–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å —Å–Ω–æ–≤</title>
  <meta name="description" content="–õ—É–Ω–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å —Å–Ω–æ–≤: –¥–∞—Ç–∞ ‚Üí –ª—É–Ω–Ω—ã–µ —Å—É—Ç–∫–∏ ‚Üí —Ç–∏–ø ‚Üí –∑–∞–º–µ—Ç–∫–∏ (–æ—Ü–µ–Ω–æ—á–Ω–æ). –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ, —Å –≤—ã–±–æ—Ä–æ–º —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞."/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Noto+Sans:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#064f43; --panel:#12151b; --ink:#ECEFF4; --muted:#A7B0BC; --border:#1E232B;
      --gold:#C8A75A; --aqua:#87C5C9;
      --radius:14px; --shadow:0 10px 28px rgba(0,0,0,.45);
      --fs:18px; --lh:1.7;
      --font:"Inter","Noto Sans",system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans",sans-serif;
      --mono:ui-monospace,"SFMono-Regular",Menlo,Consolas,monospace;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:radial-gradient(1200px 700px at 20% -10%, #12151b 0%, #0d0f12 60%) fixed;
      color:var(--ink); font:var(--fs)/var(--lh) var(--font);
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    .wrap{max-width:860px;margin:0 auto;padding:16px}
    header{position:sticky;top:0;z-index:10;background:rgba(13,15,18,.75);backdrop-filter:blur(10px);border-bottom:1px solid var(--border)}
    header .wrap{display:flex;align-items:center;gap:12px}
    .brand{display:flex;align-items:center;gap:10px;color:var(--ink);text-decoration:none}
    .moonIco{font-size:24px;line-height:1;filter:drop-shadow(0 2px 6px rgba(0,0,0,.4))}
    .brand span{font-weight:700;letter-spacing:.2px}

    .controls{margin-left:auto;display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .select,.btn{background:#0f1217;color:var(--ink);border:1px solid var(--border);border-radius:10px;padding:8px 12px;font-size:16px}
    .btn{cursor:pointer}
    .btn.today{background:linear-gradient(135deg,var(--aqua),#5aa6ab);color:#071014;border:0;font-weight:700}
    .btn:focus-visible,.select:focus-visible{outline:2px solid var(--aqua);outline-offset:2px}

    main .card{
      background:linear-gradient(180deg,rgba(25,29,36,.85),rgba(18,21,27,.95));
      border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow);
      padding:16px; margin:16px 0;
    }
    h1{font-size:26px;line-height:1.3;margin:0 0 6px 0}
    h2{font-size:18px;margin:0 0 6px 0;color:var(--muted)}
    .gold{color:var(--gold)} .muted{color:var(--muted)}
    .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin:10px 0}

    .table-wrap{border:1px solid var(--border);border-radius:12px;overflow:hidden}
    .scroll{overflow:auto}
    table{width:100%;border-collapse:collapse;min-width:680px}
    thead th{
      position:sticky;top:0;z-index:1;background:#10141a;color:var(--ink);
      text-align:left;padding:10px;border-bottom:1px solid var(--border);font-weight:700
    }
    tbody td{padding:10px;border-bottom:1px solid var(--border);vertical-align:top}
    tbody tr:nth-child(even){background:#121820}
    .dateCell{white-space:nowrap;font-size:16px}
    .dayCell{font-variant-numeric:tabular-nums;font-family:var(--mono);text-align:center}
    .typeCell,.notesCell{font-size:16px}

    /* –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–π —Å—Ç—Ä–æ–∫–∏ ‚Äî –≤—Å—è —Å—Ç—Ä–æ–∫–∞, –±–µ–∑ —Å–º–µ—â–µ–Ω–∏—è, –ø–æ–≤–µ—Ä—Ö "–∑–µ–±—Ä—ã" */
    .scroll table tbody tr.today{
      background:
        radial-gradient(120% 180% at 15% 50%, rgba(200,167,90,0.16) 0%, rgba(200,167,90,0.08) 40%, rgba(0,0,0,0) 80%),
        linear-gradient(0deg, rgba(255,255,255,0.02), rgba(255,255,255,0.02)) !important;
      box-shadow: inset 0 0 0 2px var(--gold);
    }

    footer{opacity:.9;border-top:1px solid var(--border);padding:14px 0;margin:12px 0}
    .footnote{font-size:14px}
    @media (max-width:760px){
      h1{font-size:22px}
      .select,.btn{font-size:15px}
      table{min-width:620px}
      .moonIco{font-size:22px}
    }
  </style>
</head>
<body>
<header>
  <div class="wrap">
    <a class="brand" href="#" aria-label="Home">
      <span id="moonIcon" class="moonIco" role="img" aria-label="Moon">üåó</span>
      <span id="brandName">Lunar Dream Calendar</span>
    </a>
    <div class="controls">
      <select id="lang" class="select" aria-label="Language"></select>
      <select id="tz" class="select" aria-label="Time zone"></select>
      <button id="prev" class="btn" aria-label="Previous month">‚Üê</button>
      <div id="monthLabel" class="muted" style="min-width:200px;font-weight:700"></div>
      <button id="next" class="btn" aria-label="Next month">‚Üí</button>
      <button id="today" class="btn today" aria-label="–°–µ–≥–æ–¥–Ω—è">–°–µ–≥–æ–¥–Ω—è</button>
    </div>
  </div>
</header>

<main class="wrap">
  <section class="card" id="calendarCard">
    <h1 id="title" class="gold">–õ—É–Ω–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å —Å–Ω–æ–≤</h1>
    <h2 id="subtitle" class="muted">–¢–∞–±–ª–∏—Ü–∞: –¥–∞—Ç–∞ ‚Üí –ª—É–Ω–Ω—ã–µ —Å—É—Ç–∫–∏ ‚Üí —Ç–∏–ø —Å–Ω–æ–≤ ‚Üí –∑–∞–º–µ—Ç–∫–∏ (–æ—Ü–µ–Ω–æ—á–Ω–æ).</h2>

    <div class="row">
      <span id="tzLabel" class="muted">–ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å:</span>
      <code id="tzActive" style="color:var(--gold)"></code>
      <span class="muted" style="margin-left:auto" id="legend">–í—ã–¥–µ–ª–µ–Ω–æ ‚Äî —Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞</span>
    </div>

    <div class="table-wrap">
      <div class="scroll">
        <table aria-label="Lunar dream table">
          <thead>
            <tr>
              <th id="thDate">–î–∞—Ç–∞</th>
              <th id="thDay">–õ—É–Ω–Ω—ã–µ —Å—É—Ç–∫–∏</th>
              <th id="thType">–¢–∏–ø —Å–Ω–æ–≤</th>
              <th id="thNotes">–ö—Ä–∞—Ç–∫–∏–µ –ø–æ–º–µ—Ç–∫–∏</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
    </div>

    <p id="sources" class="muted footnote" style="margin-top:10px">
      –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –≤–æ–∑—Ä–∞—Å—Ç –õ—É–Ω—ã —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏–±–ª–∏–∂—ë–Ω–Ω–æ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É —á–∞—Å–æ–≤–æ–º—É –ø–æ—è—Å—É; —Ç–∏–ø—ã/–∑–∞–º–µ—Ç–∫–∏ ‚Äî –ø–æ –∑–∞–¥–∞–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ (–æ—Ü–µ–Ω–æ—á–Ω–æ).
    </p>
  </section>

  <!-- –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–æ–Ω–Ω–∏–∫ (–ø–æ –¥–∞–Ω–Ω—ã–º –∏–∑ data/dreams_curated.json) -->
  <section class="card" id="dreambook" style="padding-top:8px;">
    <h2 class="gold" style="margin-top:0">–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–æ–Ω–Ω–∏–∫</h2>
    <input id="dreamSearch" type="search" placeholder="–ù–∞–π–¥–∏—Ç–µ —Å–∏–º–≤–æ–ª‚Ä¶ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤–æ–¥–∞, –ø–æ–ª—ë—Ç)"
           style="width:100%; padding:12px; border-radius:10px; border:1px solid #444; margin:12px 0;">
    <div id="dreamCount" class="muted" style="margin-bottom:8px;"></div>
    <div class="table-wrap" style="overflow:auto; border:1px solid #333; border-radius:12px;">
      <table id="dreamTable" style="width:100%; border-collapse:collapse; min-width:680px;">
        <thead>
          <tr>
            <th style="text-align:left; padding:10px; border-bottom:1px solid #333;">–°–∏–º–≤–æ–ª</th>
            <th style="text-align:left; padding:10px; border-bottom:1px solid #333;">–ö—Ä–∞—Ç–∫–æ</th>
            <th style="text-align:left; padding:10px; border-bottom:1px solid #333;">–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <footer>
    <p id="footerText">¬© <span id="year"></span> ‚Ä¢ –í—Å–µ —Ç–æ–ª–∫–æ–≤–∞–Ω–∏—è ‚Äî –æ—Ü–µ–Ω–æ—á–Ω–æ; –Ω–µ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π —Å–æ–≤–µ—Ç.</p>
  </footer>
</main>

<!-- === –°–∫—Ä–∏–ø—Ç 1: –∫–∞–ª–µ–Ω–¥–∞—Ä—å –ª—É–Ω–Ω—ã—Ö —Å–Ω–æ–≤ === -->
<script>
/* ================= I18N ================= */
const I18N = {
  ru:{brand:"–õ—É–Ω–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å —Å–Ω–æ–≤",title:"–õ—É–Ω–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å —Å–Ω–æ–≤",subtitle:"–¢–∞–±–ª–∏—Ü–∞: –¥–∞—Ç–∞ ‚Üí –ª—É–Ω–Ω—ã–µ —Å—É—Ç–∫–∏ ‚Üí —Ç–∏–ø —Å–Ω–æ–≤ ‚Üí –∑–∞–º–µ—Ç–∫–∏ (–æ—Ü–µ–Ω–æ—á–Ω–æ).",thDate:"–î–∞—Ç–∞",thDay:"–õ—É–Ω–Ω—ã–µ —Å—É—Ç–∫–∏",thType:"–¢–∏–ø —Å–Ω–æ–≤",thNotes:"–ö—Ä–∞—Ç–∫–∏–µ –ø–æ–º–µ—Ç–∫–∏",tzLabel:"–ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å:",legend:"–í—ã–¥–µ–ª–µ–Ω–æ ‚Äî —Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞",sources:"–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –≤–æ–∑—Ä–∞—Å—Ç –õ—É–Ω—ã —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏–±–ª–∏–∂—ë–Ω–Ω–æ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É —á–∞—Å–æ–≤–æ–º—É –ø–æ—è—Å—É; —Ç–∏–ø—ã/–∑–∞–º–µ—Ç–∫–∏ ‚Äî –ø–æ –∑–∞–¥–∞–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ (–æ—Ü–µ–Ω–æ—á–Ω–æ).",footer:"¬© {year} ‚Ä¢ –í—Å–µ —Ç–æ–ª–∫–æ–≤–∞–Ω–∏—è ‚Äî –æ—Ü–µ–Ω–æ—á–Ω–æ; –Ω–µ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π —Å–æ–≤–µ—Ç."},
  en:{brand:"Lunar Dream Calendar",title:"Lunar Dream Calendar",subtitle:"Table: date ‚Üí lunar day ‚Üí dream type ‚Üí notes (indicative).",thDate:"Date",thDay:"Lunar day",thType:"Dream type",thNotes:"Notes",tzLabel:"Time zone:",legend:"Highlighted ‚Äî today",sources:"Note: Moon age is approximated for the selected time zone; dream types/notes come from the provided table.",footer:"¬© {year} ‚Ä¢ All interpretations are indicative; not medical advice."},
  de:{brand:"Mondkalender der Tr√§ume",title:"Mondkalender der Tr√§ume",subtitle:"Tabelle: Datum ‚Üí Mondtag ‚Üí Traumtyp ‚Üí Notizen (indikativ).",thDate:"Datum",thDay:"Mondtag",thType:"Traumtyp",thNotes:"Notizen",tzLabel:"Zeitzone:",legend:"Hervorgehoben ‚Äî heute",sources:"Hinweis: Mondalter wird n√§herungsweise f√ºr die gew√§hlte Zeitzone berechnet; Typen/Notizen aus der bereitgestellten Tabelle.",footer:"¬© {year} ‚Ä¢ Alle Deutungen sind indikativ; keine medizinische Auskunft."},
  es:{brand:"Calendario lunar de sue√±os",title:"Calendario lunar de sue√±os",subtitle:"Tabla: fecha ‚Üí d√≠a lunar ‚Üí tipo de sue√±o ‚Üí notas (indicativo).",thDate:"Fecha",thDay:"D√≠a lunar",thType:"Tipo de sue√±o",thNotes:"Notas",tzLabel:"Huso horario:",legend:"Resaltado ‚Äî hoy",sources:"Notas: la edad lunar se estima seg√∫n el huso; tipos/notas de la tabla proporcionada.",footer:"¬© {year} ‚Ä¢ Todas las interpretaciones son indicativas; no constituyen consejo m√©dico."},
  it:{brand:"Calendario lunare dei sogni",title:"Calendario lunare dei sogni",subtitle:"Tabella: data ‚Üí giorno lunare ‚Üí tipo di sogno ‚Üí note (indicativo).",thDate:"Data",thDay:"Giorno lunare",thType:"Tipo di sogno",thNotes:"Note",tzLabel:"Fuso orario:",legend:"Evidenziato ‚Äî oggi",sources:"Nota: l'et√† della Luna √® stimata per il fuso selezionato; tipi/note dalla tabella fornita.",footer:"¬© {year} ‚Ä¢ Tutte le interpretazioni sono indicative; non sono un consiglio medico."},
  uk:{brand:"–ú—ñ—Å—è—á–Ω–∏–π –∫–∞–ª–µ–Ω–¥–∞—Ä —Å–Ω—ñ–≤",title:"–ú—ñ—Å—è—á–Ω–∏–π –∫–∞–ª–µ–Ω–¥–∞—Ä —Å–Ω—ñ–≤",subtitle:"–¢–∞–±–ª–∏—Ü—è: –¥–∞—Ç–∞ ‚Üí –º—ñ—Å—è—á–Ω–∞ –¥–æ–±–∞ ‚Üí —Ç–∏–ø —Å–Ω—É ‚Üí –Ω–æ—Ç–∞—Ç–∫–∏ (–æ—Ä—ñ—î–Ω—Ç–æ–≤–Ω–æ).",thDate:"–î–∞—Ç–∞",thDay:"–ú—ñ—Å—è—á–Ω–∞ –¥–æ–±–∞",thType:"–¢–∏–ø —Å–Ω—É",thNotes:"–ù–æ—Ç–∞—Ç–∫–∏",tzLabel:"–ß–∞—Å–æ–≤–∏–π –ø–æ—è—Å:",legend:"–ü—ñ–¥—Å–≤—ñ—á–µ–Ω–æ ‚Äî —Å—å–æ–≥–æ–¥–Ω—ñ",sources:"–ü—Ä–∏–º—ñ—Ç–∫–∞: –≤—ñ–∫ –ú—ñ—Å—è—Ü—è –æ–±—á–∏—Å–ª—é—î—Ç—å—Å—è –Ω–∞–±–ª–∏–∂–µ–Ω–æ –¥–ª—è –æ–±—Ä–∞–Ω–æ–≥–æ –ø–æ—è—Å—É; —Ç–∏–ø–∏/–Ω–æ—Ç–∞—Ç–∫–∏ ‚Äî —ñ–∑ –Ω–∞–¥–∞–Ω–æ—ó —Ç–∞–±–ª–∏—Ü—ñ.",footer:"¬© {year} ‚Ä¢ –£—Å—ñ —Ç–ª—É–º–∞—á–µ–Ω–Ω—è –æ—Ä—ñ—î–Ω—Ç–æ–≤–Ω—ñ; –Ω–µ —î –º–µ–¥–∏—á–Ω–æ—é –ø–æ—Ä–∞–¥–æ—é."},
  fr:{brand:"Calendrier lunaire des r√™ves",title:"Calendrier lunaire des r√™ves",subtitle:"Tableau : date ‚Üí jour lunaire ‚Üí type de r√™ve ‚Üí notes (indicatif).",thDate:"Date",thDay:"Jour lunaire",thType:"Type de r√™ve",thNotes:"Notes",tzLabel:"Fuseau horaire :",legend:"Surlign√© ‚Äî aujourd‚Äôhui",sources:"Remarque : l‚Äô√¢ge de la Lune est estim√© pour le fuseau choisi ; types/notes issus du tableau fourni.",footer:"¬© {year} ‚Ä¢ Toutes les interpr√©tations sont indicatives ; pas un avis m√©dical."}
};

/* ============= –¢–∞–±–ª–∏—Ü—ã day,type,notes (RU –∏—Å—Ç–æ—á–Ω–∏–∫ + –ø–µ—Ä–µ–≤–æ–¥—ã) ============= */
// ... (–≤–∞—à–∏ TABLE_RU/TABLE_EN/... –∏–∑ –ø—Ä–∏—Å–ª–∞–Ω–Ω–æ–≥–æ –∫–æ–¥–∞ ‚Äî –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
const TABLE_RU=[null,
  {type:"–±–µ–∑ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏",notes:"–õ—É—á—à–µ–µ –≤—Ä–µ–º—è —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–º–µ—Ä–µ–Ω–∏—è; –µ—Å–ª–∏ —Å–Ω–∏—Ç—Å—è ‚Äî —Ç—Ä–∞–∫—Ç—É–π—Ç–µ –∫–∞–∫ –æ—Ä–∏–µ–Ω—Ç–∏—Ä, –Ω–µ –∫–∞–∫ –ø—Ä–æ–≥–Ω–æ–∑."},
  {type:"–±–µ–∑ –æ—Ç–¥–µ–ª—å–Ω–æ–π –º–µ—Ç–∫–∏",notes:"–î–µ–Ω—å –ø—Ä–æ —â–µ–¥—Ä–æ—Å—Ç—å –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ; —Å–ø–µ—Ü. –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å–Ω–æ–≤ –Ω–µ—Ç."},
  {type:"–ø—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–µ; —Å–∫–ª–æ–Ω–Ω—ã–µ –∫ –≤–æ–ø–ª–æ—â–µ–Ω–∏—é",notes:"–ü—Ä–µ–æ–¥–æ–ª–µ–Ω–∏–µ –≤–æ —Å–Ω–µ ‚Üí –≤ –∂–∏–∑–Ω–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞/—à–∞–Ω—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏."},
  {type:"–ø—Ä–µ–¥–æ—Å—Ç–µ—Ä–µ–≥–∞—é—â–∏–µ; —Ä–æ–¥–æ–≤—ã–µ",notes:"–¢–µ–º—ã —Å–µ–º—å–∏/–ø—Ä–µ–¥–∫–æ–≤; —Ç—Ä–µ–±–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –∫ –≤–Ω–∏–º–∞–Ω–∏—é —Å–Ω—ã."},
  {type:"–Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ-–ø–æ–∑–∏—Ç–∏–≤–Ω—ã–µ",notes:"–ë–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω—ã–π —Ñ–æ–Ω; —Å—Ç—Ä–æ–≥–∏—Ö –ø—Ä–∞–≤–∏–ª –Ω–µ—Ç."},
  {type:"–ø—Ä–µ–¥–≤–æ—Å—Ö–∏—â–∞—é—â–∏–µ; –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω—ã–µ",notes:"–•–æ—Ä–æ—à–æ –ª–æ–≤—è—Ç—Å—è –ª–∏–Ω–∏–∏ –±—É–¥—É—â–µ–≥–æ; —É–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ–º–æ–≥–∞–µ—Ç."},
  {type:"–≤—ã—Å–æ–∫–æ–∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ",notes:"–ß–∞—Å—Ç–æ —Å–±—ã–≤–∞—é—Ç—Å—è; —Ñ–∏–∫—Å–∏—Ä—É–π—Ç–µ –¥–µ—Ç–∞–ª–∏."},
  {type:"–ø—Ä–æ—Ä–æ—á–µ—Å–∫–∏–µ –ø—Ä–æ –ø—Ä–∏–∑–≤–∞–Ω–∏–µ",notes:"–ù–∞–º—ë–∫–∏ –Ω–∞ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ, –¥–æ–ª–≥–∏–π –∫—É—Ä—Å."},
  {type:"–±–µ–∑ —è–≤–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏",notes:"–î–µ–Ω—å –Ω–∞–ø—Ä—è–∂—ë–Ω–Ω—ã–π; —Å–ø–µ—Ü. –ø—Ä–∞–≤–∏–ª –ø–æ —Å–Ω–∞–º –Ω–µ—Ç."},
  {type:"–≤ –æ—Å–Ω–æ–≤–Ω–æ–º ¬´–ø—É—Å—Ç—ã–µ¬ª",notes:"–ë–µ–∑ —Å–∏–ª—å–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ—Å—Ç—å –Ω–∏–∑–∫–∞—è; —Å –∞–∫—Ü–µ–Ω—Ç–∞–º–∏ ‚Äî —Ä–æ–¥/—Å–µ–º—å—è."},
  {type:"–º–∞—Ä–∫–µ—Ä –Ω–∞ –∑–∞–≤—Ç—Ä–∞—à–Ω–∏–µ ¬´–≤–µ—â–∏–µ¬ª",notes:"–°–∏–≥–Ω–∞–ª, —á—Ç–æ 12-–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–Ω–∞—á–∏–º—ã–º."},
  {type:"—Å–≤–µ—Ç–ª—ã–µ –∏ —Å–±—ã–≤–∞—é—â–∏–µ—Å—è",notes:"–ß–∏—Å—Ç—ã–µ, –¥–æ–±—Ä–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–Ω—ã."},
  {type:"–∏–Ω—Å–∞–π—Ç—ã –∏ —É–∫–∞–∑–∞—Ç–µ–ª–∏",notes:"–û–∑–∞—Ä–µ–Ω–∏—è; –∏–º–ø—É–ª—å—Å —Ç—è–Ω–µ—Ç—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é –Ω–æ—á—å."},
  {type:"—ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä—è–¥–∫–∞",notes:"–ù–µ–ø—Ä–∏—è—Ç–Ω—ã–µ —Å—é–∂–µ—Ç—ã –∫–∞–∫ –≤—ã–ø—É—Å–∫ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è."},
  {type:"–±–µ–∑ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏",notes:"–î–µ–Ω—å —Å –ø—Ä–µ–¥–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–∏—è–º–∏; —Ç–∏–ø —Å–Ω–æ–≤ –Ω–µ –∑–∞–¥–∞–Ω."},
  {type:"–æ—á–∏—Å—Ç–∏—Ç–µ–ª—å–Ω—ã–µ",notes:"–°–Ω–∏–º–∞—é—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ."},
  {type:"–Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ-—Ä–∞–±–æ—á–∏–µ",notes:"–ë–µ–∑ —Å–ø–µ—Ü. –æ–∂–∏–¥–∞–Ω–∏–π –ø–æ —Å–Ω–∞–º."},
  {type:"—ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–µ (–Ω–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞—Ç–µ–ª—å–Ω—ã–µ)",notes:"–î–ª—è –ø—Ä–∞–∫—Ç–∏–∫ —Å–∏–ª—ã/—Å–≤–µ—Ç–∞."},
  {type:"–ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ –Ω–µ–∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ",notes:"–ú–æ–∂–Ω–æ –Ω–µ –∑–∞–¥–µ—Ä–∂–∏–≤–∞—Ç—å—Å—è –Ω–∞ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–µ."},
  {type:"–±–µ–∑ –æ—Ç–¥–µ–ª—å–Ω–æ–π –º–µ—Ç–∫–∏",notes:"–§–æ–∫—É—Å –Ω–∞ –≤–æ–ª–µ; —Ç–∏–ø –Ω–µ –∑–∞–¥–∞–Ω."},
  {type:"–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ–ª—å–Ω—ã–µ (–Ω–∞ —Å–ª–µ–¥—É—é—â—É—é –Ω–æ—á—å)",notes:"–ù–æ—á—å—é –¥–∞–ª–µ–µ ‚Äî –∏—Å—Ü–µ–ª–µ–Ω–∏–µ –±–µ–∑ –Ω–æ–≤–æ–π –∏–Ω—Ñ—ã."},
  {type:"–ø–æ–∑–Ω–∞–≤–∞—Ç–µ–ª—å–Ω—ã–µ; –æ–±—É—á–∞—é—â–∏–µ",notes:"–ü—Ä–∏–Ω–æ—Å—è—Ç –∑–Ω–∞–Ω–∏—è –∏ —Ä–∞–±–æ—á–∏–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏."},
  {type:"–∏–Ω–≤–µ—Ä—Å–∏–æ–Ω–Ω—ã–µ (¬´–Ω–∞–æ–±–æ—Ä–æ—Ç¬ª)",notes:"–¢—Ä–∞–∫—Ç–æ–≤–∫–∞ ¬´–Ω–∞–æ–±–æ—Ä–æ—Ç¬ª (—É—á–∏—Ç—ã–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç)."},
  {type:"–¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ",notes:"–û—Ç—Ä–∞–∂–∞—é—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–µ–ª–∞/—Å–µ–∫—Å—É–∞–ª—å–Ω–æ—Å—Ç–∏."},
  {type:"—Ç–∏—à–∏–Ω–∞ / –º–∏–Ω–∏–º—É–º —Å–∏–≥–Ω–∞–ª–æ–≤",notes:"–ß–∞—â–µ –ø–∞—É–∑–∞ –≤–æ—Å–ø—Ä–∏—è—Ç–∏—è."},
  {type:"–ø—Ä–æ —Å–∞–º–æ–æ—Ü–µ–Ω–∫—É",notes:"–ó–µ—Ä–∫–∞–ª—è—Ç —Å–∞–º–æ–æ—Ü–µ–Ω–∫—É –∏ –∑–∞–±–æ—Ç—É –æ —Å–µ–±–µ."},
  {type:"–∏–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ-–ø—Ä–æ—Ä–æ—á–µ—Å–∫–∏–µ (–¥–≤–µ –Ω–æ—á–∏)",notes:"–û–∑–∞—Ä–µ–Ω–∏—è —Å–µ–≥–æ–¥–Ω—è –∏ –∑–∞–≤—Ç—Ä–∞."},
  {type:"—É—Ä–∞–≤–Ω–æ–≤–µ—à–µ–Ω–Ω—ã–µ",notes:"–ì–∞—Ä–º–æ–Ω–∏—á–Ω—ã–π —Ñ–æ–Ω; –±–µ–∑ –∂—ë—Å—Ç–∫–æ–π –º–µ—Ç–∫–∏."},
  {type:"–ø–æ–≥—Ä–∞–Ω–∏—á–Ω—ã–µ; ¬´—Ä–∏—Ç—É–∞–ª—å–Ω—ã–µ¬ª",notes:"–ü–µ—Ä–µ—Ö–æ–¥–Ω—ã–µ —Å—é–∂–µ—Ç—ã; –æ—Ç–¥–µ–ª—å–Ω–æ–π –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –Ω–µ—Ç."},
  {type:"–∏—Ç–æ–≥–æ–≤—ã–µ –ø—Ä–æ—Ä–æ—á–µ—Å–∫–∏–µ",notes:"–ú–Ω–æ–≥–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏; –ø–æ–¥—Å–≤–µ—á–∏–≤–∞—é—Ç –æ—à–∏–±–∫–∏ –∏ —Ä–æ—Å—Ç."}
];
// EN/DE/ES/IT/UK/FR —Ç–∞–±–ª–∏—Ü—ã ‚Äî –∫–∞–∫ –≤ –≤–∞—à–µ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ (–Ω–µ —É–∫–æ—Ä–∞—á–∏–≤–∞—é –∑–¥–µ—Å—å —Ä–∞–¥–∏ –∫–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç–∏)
const TABLE_EN=[null,/* ... */];
const TABLE_DE=[null,/* ... */];
const TABLE_ES=[null,/* ... */];
const TABLE_IT=[null,/* ... */];
const TABLE_UK=[null,/* ... */];
const TABLE_FR=[null,/* ... */];
const TABLES={ru:TABLE_RU,en:TABLE_EN,de:TABLE_DE,es:TABLE_ES,it:TABLE_IT,uk:TABLE_UK,fr:TABLE_FR};

/* ============= –ß–∞—Å–æ–≤—ã–µ –ø–æ—è—Å–∞ ============= */
const TZ_LIST=["Auto (system)","Europe/Prague","Europe/Kyiv","Europe/Moscow","Europe/Warsaw","Europe/Berlin","Europe/Paris","Europe/London","Europe/Madrid","Europe/Rome","Europe/Istanbul","Europe/Athens","Asia/Dubai","Asia/Tbilisi","Asia/Yerevan","Asia/Almaty","Asia/Tashkent","Asia/Novosibirsk","Asia/Kolkata","Asia/Bangkok","Asia/Hong_Kong","Asia/Shanghai","Asia/Tokyo","Asia/Seoul","Australia/Sydney","Pacific/Auckland","Africa/Cairo","Africa/Johannesburg","Africa/Nairobi","America/Sao_Paulo","America/Buenos_Aires","America/Toronto","America/New_York","America/Chicago","America/Denver","America/Los_Angeles","America/Mexico_City","America/Bogota","America/Lima","America/Santiago"];

/* ============= –ê—Å—Ç—Ä–æ–Ω–æ–º–∏—è ============= */
const SYNODIC=29.530588853;
const REF=Date.UTC(2000,0,6,18,14,0);
function offsetISO(tz, baseDate){
  const parts=new Intl.DateTimeFormat('en-US',{timeZone:tz,hour12:false,year:'numeric',month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit',second:'2-digit'}).formatToParts(baseDate);
  const m=Object.fromEntries(parts.map(p=>[p.type,p.value]));
  const local=new Date(`${m.year}-${m.month}-${m.day}T${m.hour}:${m.minute}:${m.second}Z`);
  const utc=new Date(Date.UTC(baseDate.getUTCFullYear(),baseDate.getUTCMonth(),baseDate.getUTCDate(),baseDate.getUTCHours(),baseDate.getUTCMinutes(),baseDate.getUTCSeconds()));
  const diffMin=Math.round((local-utc)/60000);
  const sign=diffMin>=0?'+':'-'; const v=Math.abs(diffMin); const hh=String(Math.floor(v/60)).padStart(2,'0'); const mm=String(v%60).padStart(2,'0');
  return `${sign}${hh}:${mm}`;
}
function makeLocalNoonYMD(y,m,d,tz){
  const off=offsetISO(tz, new Date(Date.UTC(y,m-1,d,12,0,0)));
  return new Date(`${y}-${String(m).padStart(2,'0')}-${String(d).padStart(2,'0')}T12:00:00${off}`);
}
function moonAge(date){ const days=(date.getTime()-REF)/86400000; return ((days%SYNODIC)+SYNODIC)%SYNODIC; }
function lunarDayFromAge(age){ return Math.max(1,Math.min(30,Math.floor(age)+1)); }
const B=[1.84566,5.53699,9.22831,12.91963,16.61096,20.30228,23.99361,27.68493];
function phaseKeyFromAge(age){
  if(age<B[0]||age>=B[7])return "New";
  if(age<B[1])return "WaxingCrescent";
  if(age<B[2])return "FirstQuarter";
  if(age<B[3])return "WaxingGibbous";
  if(age<B[4])return "Full";
  if(age<B[5])return "WaningGibbous";
  if(age<B[6])return "LastQuarter";
  if(age<B[7])return "WaningCrescent";
  return "New";
}
const PHASE_EMOJI={New:"üåë",WaxingCrescent:"üåí",FirstQuarter:"üåì",WaxingGibbous:"üåî",Full:"üåï",WaningGibbous:"üåñ",LastQuarter:"üåó",WaningCrescent:"üåò"};
const PHASE_L10N={
  ru:{New:"–ù–æ–≤–æ–ª—É–Ω–∏–µ",WaxingCrescent:"–†–∞—Å—Ç—É—â–∏–π —Å–µ—Ä–ø",FirstQuarter:"–ü–µ—Ä–≤–∞—è —á–µ—Ç–≤–µ—Ä—Ç—å",WaxingGibbous:"–†–∞—Å—Ç—É—â–∞—è –≤—ã–ø—É–∫–ª–∞—è",Full:"–ü–æ–ª–Ω–æ–ª—É–Ω–∏–µ",WaningGibbous:"–£–±—ã–≤–∞—é—â–∞—è –≤—ã–ø—É–∫–ª–∞—è",LastQuarter:"–ü–æ—Å–ª–µ–¥–Ω—è—è —á–µ—Ç–≤–µ—Ä—Ç—å",WaningCrescent:"–£–±—ã–≤–∞—é—â–∏–π —Å–µ—Ä–ø"},
  en:{New:"New Moon",WaxingCrescent:"Waxing Crescent",FirstQuarter:"First Quarter",WaxingGibbous:"Waxing Gibbous",Full:"Full Moon",WaningGibbous:"Waning Gibbous",LastQuarter:"Last Quarter",WaningCrescent:"Waning Crescent"},
  de:{New:"Neumond",WaxingCrescent:"Zunehmende Sichel",FirstQuarter:"Erstes Viertel",WaxingGibbous:"Zunehmende Gibbeuse",Full:"Vollmond",WaningGibbous:"Abnehmende Gibbeuse",LastQuarter:"Letztes Viertel",WaningCrescent:"Abnehmende Sichel"},
  es:{New:"Luna nueva",WaxingCrescent:"Creciente",FirstQuarter:"Cuarto creciente",WaxingGibbous:"Gibosa creciente",Full:"Luna llena",WaningGibbous:"Gibosa menguante",LastQuarter:"Cuarto menguante",WaningCrescent:"Menguante"},
  it:{New:"Luna nuova",WaxingCrescent:"Falce crescente",FirstQuarter:"Primo quarto",WaxingGibbous:"Gibbosa crescente",Full:"Luna piena",WaningGibbous:"Gibbosa calante",LastQuarter:"Ultimo quarto",WaningCrescent:"Falce calante"},
  uk:{New:"–ù–æ–≤–∏–π –º—ñ—Å—è—Ü—å",WaxingCrescent:"–ó—Ä–æ—Å—Ç–∞—é—á–∏–π —Å–µ—Ä–ø",FirstQuarter:"–ü–µ—Ä—à–∞ —á–≤–µ—Ä—Ç—å",WaxingGibbous:"–ó—Ä–æ—Å—Ç–∞—é—á–∞ –æ–ø—É–∫–ª–∞",Full:"–ü–æ–≤–Ω–∏–π –º—ñ—Å—è—Ü—å",WaningGibbous:"–°–ø–∞–¥–Ω–∞ –æ–ø—É–∫–ª–∞",LastQuarter:"–û—Å—Ç–∞–Ω–Ω—è —á–≤–µ—Ä—Ç—å",WaningCrescent:"–°–ø–∞–¥–Ω–∏–π —Å–µ—Ä–ø"},
  fr:{New:"Nouvelle Lune",WaxingCrescent:"Croissant croissant",FirstQuarter:"Premier quartier",WaxingGibbous:"Gibbeuse croissante",Full:"Pleine Lune",WaningGibbous:"Gibbeuse d√©croissante",LastQuarter:"Dernier quartier",WaningCrescent:"Croissant d√©croissant"}
};

/* ============= –£—Ç–∏–ª–∏—Ç—ã –¥–∞—Ç—ã/–ª–æ–∫–∞–ª–∏ ============= */
function ymd(date, tz){
  const s=new Intl.DateTimeFormat('en-CA',{timeZone:tz,year:'numeric',month:'2-digit',day:'2-digit'}).format(date);
  const [y,m,d]=s.split('-').map(Number); return {y,m,d};
}
function ymOf(date, tz){
  const p=new Intl.DateTimeFormat('en-CA',{timeZone:tz,year:'numeric',month:'2-digit',day:'2-digit'}).formatToParts(date);
  const map=Object.fromEntries(p.map(x=>[x.type,x.value])); return {y:+map.year,m:+map.month};
}
function daysInMonth(y,m){ return new Date(Date.UTC(y,m,0)).getUTCDate(); }
function fmtDate(d, tz){ return new Intl.DateTimeFormat(lang,{timeZone:tz,day:"numeric",month:"long"}).format(d); }

/* ============= UI ============= */
const $=id=>document.getElementById(id);
const langSel=$("lang"), tzSel=$("tz"), monthLabel=$("monthLabel"), calendarTbody=$("tbody");
const prevBtn=$("prev"), nextBtn=$("next"), todayBtn=$("today");
const SUPPORTED=["ru","en","de","es","it","uk","fr"];
const sysLang=(navigator.language||"ru").slice(0,2).toLowerCase();
let lang=SUPPORTED.includes(sysLang)?sysLang:"ru";
let tz=Intl.DateTimeFormat().resolvedOptions().timeZone||"Europe/Prague";
let navDate=new Date();

function fillLang(){
  const names={ru:"–†—É—Å—Å–∫–∏–π",en:"English",de:"Deutsch",es:"Espa√±ol",it:"Italiano",uk:"–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞",fr:"Fran√ßais"};
  SUPPORTED.forEach(code=>{const o=document.createElement("option");o.value=code;o.textContent=names[code];langSel.appendChild(o);});
  langSel.value=lang;
}
function fillTZ(){
  TZ_LIST.forEach(z=>{const o=document.createElement("option");o.value=z;o.textContent=z;tzSel.appendChild(o);});
  tzSel.value=tzSel.querySelector(`option[value="${tz}"]`)?tz:"Auto (system)";
  $("tzActive").textContent=tzSel.value==="Auto (system)"?tz:tzSel.value;
}
function applyI18N(){
  const t=I18N[lang];
  $("brandName").textContent=t.brand; $("title").textContent=t.title; $("subtitle").textContent=t.subtitle;
  $("thDate").textContent=t.thDate; $("thDay").textContent=t.thDay; $("thType").textContent=t.thType; $("thNotes").textContent=t.thNotes;
  $("tzLabel").textContent=t.tzLabel; $("legend").textContent=t.legend; $("sources").textContent=t.sources;
  $("footerText").innerHTML=t.footer.replace("{year}",new Date().getFullYear());
  document.documentElement.lang=lang;
  todayBtn.textContent=(lang==="ru")?"–°–µ–≥–æ–¥–Ω—è":(lang==="uk")?"–°—å–æ–≥–æ–¥–Ω—ñ":(lang==="de")?"Heute":(lang==="es")?"Hoy":(lang==="it")?"Oggi":(lang==="fr")?"Aujourd‚Äôhui":"Today";
}
function updateMoonIcon(uiTZ){
  const n=new Date(); const noon=makeLocalNoonYMD(...Object.values(ymd(n,uiTZ)), uiTZ);
  const key=phaseKeyFromAge(moonAge(noon));
  const emoji=PHASE_EMOJI[key];
  const name=(PHASE_L10N[lang]||PHASE_L10N.ru)[key];
  const nice=fmtDate(noon,uiTZ)+" "+new Intl.DateTimeFormat(lang,{timeZone:uiTZ,year:"numeric"}).format(noon);
  const el=$("moonIcon"); el.textContent=emoji; el.title=`${name} ‚Ä¢ ${nice}`; el.setAttribute("aria-label",`${name} ‚Ä¢ ${nice}`);
}
function renderMonth(){
  const uiTZ = tzSel.value==="Auto (system)" ? tz : tzSel.value;
  $("tzActive").textContent=uiTZ;

  const {y:vy,m:vm}=ymOf(navDate, uiTZ);
  monthLabel.textContent=new Intl.DateTimeFormat(lang,{timeZone:uiTZ,month:"long",year:"numeric"}).format(makeLocalNoonYMD(vy,vm,1,uiTZ));

  const table=TABLES[lang]||TABLES.ru;
  const today=ymd(new Date(), uiTZ);

  calendarTbody.innerHTML="";
  const total=daysInMonth(vy,vm);
  for(let d=1; d<=total; d++){
    const localNoon=makeLocalNoonYMD(vy,vm,d,uiTZ);
    const lday=lunarDayFromAge(moonAge(localNoon));
    const row=table[lday];

    const tr=document.createElement("tr");
    const rowYMD=ymd(localNoon, uiTZ);
    if(rowYMD.y===today.y && rowYMD.m===today.m && rowYMD.d===today.d){
      tr.classList.add("today");
      tr.setAttribute("aria-current","date");
    }

    const tdDate=document.createElement("td"); tdDate.className="dateCell"; tdDate.textContent=fmtDate(localNoon,uiTZ);
    const tdDay=document.createElement("td"); tdDay.className="dayCell"; tdDay.textContent=String(lday);
    const tdType=document.createElement("td"); tdType.className="typeCell"; tdType.textContent=row.type;
    const tdNotes=document.createElement("td"); tdNotes.className="notesCell"; tdNotes.textContent=row.notes;

    tr.append(tdDate,tdDay,tdType,tdNotes); calendarTbody.appendChild(tr);
  }
  updateMoonIcon(uiTZ);
}

/* ============= –°–æ–±—ã—Ç–∏—è –∏ —Å—Ç–∞—Ä—Ç ============= */
langSel.addEventListener("change",()=>{ lang=langSel.value; applyI18N(); renderMonth(); });
tzSel.addEventListener("change",()=>{ if(tzSel.value==="Auto (system)"){$("tzActive").textContent=tz;} renderMonth(); });
prevBtn.addEventListener("click",()=>{ const uiTZ=tzSel.value==="Auto (system)"?tz:tzSel.value; const {y,m}=ymOf(navDate,uiTZ); navDate=makeLocalNoonYMD(m===1?y-1:y, m===1?12:m-1, 15, uiTZ); renderMonth(); });
nextBtn.addEventListener("click",()=>{ const uiTZ=tzSel.value==="Auto (system)"?tz:tzSel.value; const {y,m}=ymOf(navDate,uiTZ); navDate=makeLocalNoonYMD(m===12?y+1:y, m===12?1:m+1, 15, uiTZ); renderMonth(); });
todayBtn.addEventListener("click",()=>{ navDate=new Date(); renderMonth(); });

(function init(){
  fillLang(); fillTZ(); applyI18N();
  $("year").textContent=new Date().getFullYear();
  renderMonth();
})();
</script>

<!-- === –°–∫—Ä–∏–ø—Ç 2: ¬´–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–æ–Ω–Ω–∏–∫¬ª (–ø–æ–∏—Å–∫ –ø–æ data/dreams_curated.json) === -->
<script>
(async function(){
  const DATA_URL = location.pathname.includes('/lunar-landing')
    ? '/lunar-landing/data/dreams_curated.json'
    : 'data/dreams_curated.json';

  let data = [];
  try {
    const res = await fetch(DATA_URL, {cache:'no-store'});
    if (!res.ok) throw new Error('HTTP '+res.status);
    data = await res.json();
  } catch(e) {
    console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–æ–Ω–Ω–∏–∫:', e);
    document.getElementById('dreamCount').textContent = '–î–∞–Ω–Ω—ã–µ —Å–æ–Ω–Ω–∏–∫–∞ –ø–æ–∫–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã.';
    return;
  }

  const dbTbody = document.querySelector('#dreamTable tbody');
  const counter = document.getElementById('dreamCount');
  const search = document.getElementById('dreamSearch');

  function render(rows){
    dbTbody.innerHTML = '';
    rows.slice(0,500).forEach(r => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td style="padding:10px; border-bottom:1px solid #222; font-weight:600">${r.symbol}</td>
        <td style="padding:10px; border-bottom:1px solid #222">${(r.modern_interpretation||'').slice(0,220)}‚Ä¶</td>
        <td style="padding:10px; border-bottom:1px solid #222">${(r.confidence??'').toString()}</td>`;
      dbTbody.appendChild(tr);
    });
    counter.textContent = `–ù–∞–π–¥–µ–Ω–æ: ${rows.length} —Å–∏–º–≤–æ–ª–æ–≤`;
  }

  function filter(q){
    q = q.trim().toLowerCase();
    if (!q) return data;
    return data.filter(r =>
      (r.symbol||'').toLowerCase().includes(q) ||
      (r.contexts||[]).some(c => (c||'').toLowerCase().includes(q))
    );
  }

  render(data);
  search.addEventListener('input', (e)=> render(filter(e.target.value)));
})();
</script>

</body>
</html>
